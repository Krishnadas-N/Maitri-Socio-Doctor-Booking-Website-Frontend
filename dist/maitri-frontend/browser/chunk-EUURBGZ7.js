import{a as R}from"./chunk-BF7GR5O3.js";import{a as E}from"./chunk-O4H2V3WM.js";import{a as P}from"./chunk-AJCFBXF2.js";import"./chunk-OUAMXWST.js";import{a as F}from"./chunk-KTKKQ74Q.js";import{a as D}from"./chunk-3P62YLH5.js";import"./chunk-NKMITRER.js";import{a as M,b as I,c as j}from"./chunk-ONIKTDMA.js";import{C as T}from"./chunk-IWUKBY46.js";import"./chunk-7ZKIOEOA.js";import"./chunk-Y5BMXVS7.js";import{Ac as y,Bc as C,Db as S,Ea as v,Fa as b,Fb as m,Pb as s,Qb as c,Rb as d,Vb as x,Yb as w,_b as h,fb as g,fd as U,ic as u,jc as f,lb as l,mb as i,nd as _,pd as O,sc as k,ta as p}from"./chunk-PWWHKO4X.js";import"./chunk-4LMIJWLY.js";function A(n,r){if(n&1){let a=x();s(0,"div",7),w("click",function(){let t=v(a).$implicit,o=h();return b(o.navigateChat(t._id))}),s(1,"div",8),d(2,"img",9),c(),s(3,"div",10)(4,"div",11),u(5),c(),s(6,"span",12),u(7),y(8,"date"),c()()()}if(n&2){let a=r.$implicit,e=h();l(2),m("src",e.getOtherMember(a).profilePic,g),l(3),f(e.getOtherMember(a).firstName),l(2),f(C(8,3,a.lastUpdate))}}var ee=(()=>{let r=class r{constructor(e,t,o,V,N,$,z){this.webSocketService=e,this.route=t,this.tokenService=o,this.messagService=V,this.userService=N,this.doctorService=$,this.router=z,this.conversations=[],this.messageInput="",this.newMessage=""}ngOnInit(){this.userType=this.route.snapshot.data.expectedRole,this.fetchCurrentUser();let e=this.tokenService.getToken();e&&this.webSocketService.setToken(e)}loadChatsOfUser(){this.messagService.getChatsOfUSer().subscribe({next:e=>{this.conversations=e.data,console.log(" this.consversations",this.conversations)},error:e=>{console.log(e)}})}fetchCurrentUser(){this.userType==="Doctor"?this.doctorService.getDoctor().subscribe({next:e=>{this.currentUser=e.data,this.webSocketService.addUser(this.currentUser._id),console.log("currentUser",this.currentUser),this.loadChatsOfUser()},error:e=>{}}):this.userType==="User"&&this.userService.getCurrentUser().subscribe({next:e=>{this.currentUser=e.data,this.webSocketService.addUser(this.currentUser._id),console.log("currentUser",this.currentUser),this.loadChatsOfUser()},error:e=>{}})}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.webSocketService.disconnectSocket()}getOtherMember(e){return e.members.find(o=>o.member._id.toString()!==this.currentUser._id.toString()).member}navigateChat(e){this.userType==="Doctor"?this.router.navigate(["/doctor/chats",e]):this.router.navigate(["/chats/",e])}};r.\u0275fac=function(t){return new(t||r)(i(E),i(M),i(F),i(R),i(D),i(P),i(j))},r.\u0275cmp=p({type:r,selectors:[["app-chat-component"]],standalone:!0,features:[k],decls:8,vars:1,consts:[[1,"flex","w-full","h-screen","mt-1","antialiased","text-gray-800"],[1,"flex","flex-row","h-full","w-full","overflow-hidden"],[1,"flex","flex-col","py-3","pl-6","pr-2","w-1/3","bg-white","flex-shrink-0","h-screen","overflow-hidden"],[1,"flex","flex-col","w-full","border-r-2","overflow-y-hidden"],[1,"border-b-2","py-4","px-2"],["class","flex flex-row py-4 px-2 justify-center items-center border-b-2 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"w-2/3"],[1,"flex","flex-row","py-4","px-2","justify-center","items-center","border-b-2","cursor-pointer",3,"click"],[1,"w-1/4"],["alt","",1,"object-cover","h-12","w-12","rounded-full",3,"src"],[1,"w-full"],[1,"text-lg","font-semibold"],[1,"text-gray-500"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d(4,"div",4),S(5,A,9,5,"div",5),c()(),s(6,"div",6),d(7,"router-outlet"),c()()()),t&2&&(l(5),m("ngForOf",o.conversations))},dependencies:[T,I,O,U,_],styles:[".scrollbar-w-2[_ngcontent-%COMP%]::-webkit-scrollbar{width:.25rem;height:.25rem}.scrollbar-track-blue-lighter[_ngcontent-%COMP%]::-webkit-scrollbar-track{--bg-opacity: 1;background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.scrollbar-thumb-blue[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{--bg-opacity: 1;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity))}.scrollbar-thumb-rounded[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:.25rem}"]});let n=r;return n})();export{ee as ChatComponent};
