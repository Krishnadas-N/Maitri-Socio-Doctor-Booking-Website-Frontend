import{a as j,b as se,c as ce,f as le,g as ue,h as de,i as he,j as pe}from"./chunk-TQS2ZY6Q.js";import{C as H,a as re,d as x,k as ie,m as oe,t as L,v as ae,w as W}from"./chunk-PEIQAL72.js";import{C as Y,D as J,R as Z,Sa as ee,Z as N,aa as T,ba as F,c as M,f as X,ha as Q,ka as w,l as C,m as I,ma as u,n as O,o as v,sd as ne,t as R,ub as te}from"./chunk-PWWHKO4X.js";import{h as k}from"./chunk-4LMIJWLY.js";var Pe=new Map,be={activated:!1,tokenObservers:[]},Ie={initialized:!1,enabled:!1};function p(e){return Pe.get(e)||Object.assign({},be)}function Ae(){return Ie}var Re="https://content-firebaseappcheck.googleapis.com/v1";var ye="exchangeDebugToken",fe={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Qn=24*60*60*1e3;var U=class{constructor(r,t,n,i,o){if(this.operation=r,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(r){return k(this,null,function*(){this.stop();try{this.pending=new x,this.pending.promise.catch(t=>{}),yield Se(this.getNextRun(r)),this.pending.resolve(),yield this.pending.promise,this.pending=new x,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(r){if(r)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Se(e){return new Promise(r=>{setTimeout(r,e)})}var De={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},A=new oe("appCheck","AppCheck",De);function Ee(e){if(!p(e).activated)throw A.create("use-before-activation",{appName:e.name})}function Te(n,i){return k(this,arguments,function*({url:e,body:r},t){let o={"Content-Type":"application/json"},s=t.getImmediate({optional:!0});if(s){let h=yield s.getHeartbeatsHeader();h&&(o["X-Firebase-Client"]=h)}let c={method:"POST",body:JSON.stringify(r),headers:o},a;try{a=yield fetch(e,c)}catch(h){throw A.create("fetch-network-error",{originalErrorMessage:h?.message})}if(a.status!==200)throw A.create("fetch-status-error",{httpStatus:a.status});let d;try{d=yield a.json()}catch(h){throw A.create("fetch-parse-error",{originalErrorMessage:h?.message})}let g=d.ttl.match(/^([\d.]+)(s)$/);if(!g||!g[2]||isNaN(Number(g[1])))throw A.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let S=Number(g[1])*1e3,b=Date.now();return{token:d.token,expireTimeMillis:b+S,issuedAtTimeMillis:b}})}function we(e,r){let{projectId:t,appId:n,apiKey:i}=e.options;return{url:`${Re}/projects/${t}/apps/${n}:${ye}?key=${i}`,body:{debug_token:r}}}var Me="firebase-app-check-database",Oe=1,K="firebase-app-check-store";var y=null;function Ne(){return y||(y=new Promise((e,r)=>{try{let t=indexedDB.open(Me,Oe);t.onsuccess=n=>{e(n.target.result)},t.onerror=n=>{var i;r(A.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(K,{keyPath:"compositeKey"})}}}catch(t){r(A.create("storage-open",{originalErrorMessage:t?.message}))}}),y)}function Fe(e,r){return xe(Le(e),r)}function xe(e,r){return k(this,null,function*(){let n=(yield Ne()).transaction(K,"readwrite"),o=n.objectStore(K).put({compositeKey:e,value:r});return new Promise((s,c)=>{o.onsuccess=a=>{s()},n.onerror=a=>{var d;c(A.create("storage-set",{originalErrorMessage:(d=a.target.error)===null||d===void 0?void 0:d.message}))}})})}function Le(e){return`${e.options.appId}-${e.name}`}var B=new ae("@firebase/app-check");function $(e,r){return ie()?Fe(e,r).catch(t=>{B.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function _e(){return Ae().enabled}function Ce(){return k(this,null,function*(){let e=Ae();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var We={error:"UNKNOWN_ERROR"};function He(e){return re.encodeString(JSON.stringify(e),!1)}function z(e,r=!1){return k(this,null,function*(){let t=e.app;Ee(t);let n=p(t),i=n.token,o;if(i&&!P(i)&&(n.token=void 0,i=void 0),!i){let a=yield n.cachedTokenPromise;a&&(P(a)?i=a:yield $(t,void 0))}if(!r&&i&&P(i))return{token:i.token};let s=!1;if(_e()){n.exchangeTokenPromise||(n.exchangeTokenPromise=Te(we(t,yield Ce()),e.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),s=!0);let a=yield n.exchangeTokenPromise;return yield $(t,a),n.token=a,{token:a.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),s=!0),i=yield p(t).exchangeTokenPromise}catch(a){a.code==="appCheck/throttled"?B.warn(a.message):B.error(a),o=a}let c;return i?o?P(i)?c={token:i.token,internalError:o}:c=me(o):(c={token:i.token},n.token=i,yield $(t,i)):c=me(o),s&&Ke(t,c),c})}function je(e){return k(this,null,function*(){let r=e.app;Ee(r);let{provider:t}=p(r);if(_e()){let n=yield Ce(),{token:i}=yield Te(we(r,n),e.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function $e(e,r,t,n){let{app:i}=e,o=p(i),s={next:t,error:n,type:r};if(o.tokenObservers=[...o.tokenObservers,s],o.token&&P(o.token)){let c=o.token;Promise.resolve().then(()=>{t({token:c.token}),ge(e)}).catch(()=>{})}o.cachedTokenPromise.then(()=>ge(e))}function ve(e,r){let t=p(e),n=t.tokenObservers.filter(i=>i.next!==r);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function ge(e){let{app:r}=e,t=p(r),n=t.tokenRefresher;n||(n=Ue(e),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function Ue(e){let{app:r}=e;return new U(()=>k(this,null,function*(){let t=p(r),n;if(t.token?n=yield z(e,!0):n=yield z(e),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=p(r);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},fe.RETRIAL_MIN_WAIT,fe.RETRIAL_MAX_WAIT)}function Ke(e,r){let t=p(e).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&r.error!=null?n.error(r.error):n.next(r)}catch{}}function P(e){return e.expireTimeMillis-Date.now()>0}function me(e){return{token:He(We),error:e}}var G=class{constructor(r,t){this.app=r,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:r}=p(this.app);for(let t of r)ve(this.app,t.next);return Promise.resolve()}};function Be(e,r){return new G(e,r)}function ze(e){return{getToken:r=>z(e,r),getLimitedUseToken:()=>je(e),addTokenListener:r=>$e(e,"INTERNAL",r),removeTokenListener:r=>ve(e.app,r)}}var Ge="@firebase/app-check",qe="0.8.4";var Ve="app-check",ke="app-check-internal";function Xe(){W(new L(Ve,e=>{let r=e.getProvider("app").getImmediate(),t=e.getProvider("heartbeat");return Be(r,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,t)=>{e.getProvider(ke).initialize()})),W(new L(ke,e=>{let r=e.getProvider("app-check").getImmediate();return ze(r)},"PUBLIC").setInstantiationMode("EXPLICIT")),H(Ge,qe)}Xe();var Ye=["localhost","0.0.0.0","127.0.0.1"],dr=typeof window<"u"&&Ye.includes(window.location.hostname);var Ze=new w("angularfire2.auth.use-emulator"),Qe=new w("angularfire2.auth.settings"),et=new w("angularfire2.auth.tenant-id"),tt=new w("angularfire2.auth.langugage-code"),nt=new w("angularfire2.auth.use-device-language"),rt=new w("angularfire.auth.persistence"),it=(e,r,t,n,i,o,s,c)=>pe(`${e.name}.auth`,"AngularFireAuth",e.name,()=>{let a=r.runOutsideAngular(()=>e.auth());if(t&&a.useEmulator(...t),n&&(a.tenantId=n),a.languageCode=i,o&&a.useDeviceLanguage(),s)for(let[d,g]of Object.entries(s))a.settings[d]=g;return c&&a.setPersistence(c),a},[t,n,i,o,s,c]),Or=(()=>{class e{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,o,s,c,a,d,g,S,b,h){let q=new X,_=v(void 0).pipe(C(s.outsideAngular),T(()=>o.runOutsideAngular(()=>import("./chunk-S6MQ3QJ5.js"))),R(()=>he(t,o,n)),R(m=>it(m,o,c,d,g,S,a,b)),N({bufferSize:1,refCount:!1}));if(ne(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=v(null);else{_.pipe(Z()).subscribe();let m=_.pipe(T(l=>l.getRedirectResult().then(f=>f,()=>null)),ce,N({bufferSize:1,refCount:!1})),V=_.pipe(T(l=>new M(f=>({unsubscribe:o.runOutsideAngular(()=>l.onAuthStateChanged(E=>f.next(E),E=>f.error(E),()=>f.complete()))})))),D=_.pipe(T(l=>new M(f=>({unsubscribe:o.runOutsideAngular(()=>l.onIdTokenChanged(E=>f.next(E),E=>f.error(E),()=>f.complete()))}))));this.authState=m.pipe(F(V),I(s.outsideAngular),C(s.insideAngular)),this.user=m.pipe(F(D),I(s.outsideAngular),C(s.insideAngular)),this.idToken=this.user.pipe(T(l=>l?O(l.getIdToken()):v(null))),this.idTokenResult=this.user.pipe(T(l=>l?O(l.getIdTokenResult()):v(null))),this.credential=Y(m,q,this.authState.pipe(J(l=>!l))).pipe(R(l=>l?.user?l:null),I(s.outsideAngular),C(s.insideAngular))}return le(this,_,o,{spy:{apply:(m,V,D)=>{(m.startsWith("signIn")||m.startsWith("createUser"))&&D.then(l=>q.next(l))}}})}static \u0275fac=function(n){return new(n||e)(u(ue),u(de,8),u(ee),u(te),u(se),u(Ze,8),u(Qe,8),u(et,8),u(tt,8),u(nt,8),u(rt,8),u(j,8))};static \u0275prov=Q({token:e,factory:e.\u0275fac,providedIn:"any"})}return e})();export{Or as a};
